## FunctionDef document
**document**: The function of this function is to redirect to the document page. 

****Arguments: This function does not accept any arguments. 

**Code Description**: `document` A function is an asynchronous function whose primary purpose is to redirect the user's request to a document page on the server. In this project, when the user accesses the root path ("/") of the server, this function is called to automatically jump to the document page. This is achieved by returning an `RedirectResponse` object that contains the target URL (i.e., the URL of the document page). In this example, the target URL is hardcoded as "/docs", meaning that when this function is triggered, the user's browser will be redirected to the server's "/docs" path, which usually hosts interactive documentation for the API, such as Swagger UI or Redoc. 

This function is called by  the `mount_app_routes` function as part of the FastAPI app and is used to set the route when the app starts. In `mount_app_routes` a function, the`document` function is registered as a handler that handles the root path ("/") request. This way, when a user accesses the root path of the app, they are automatically redirected to the API documentation page, providing a user-friendly way to explore and test the API. 

**Note**: When using this function, you need to make sure that there is indeed a documentation page under the "/docs" path. In FastAPI, API documentation is typically automatically generated by default and can be accessed via either the "/docs" (Swagger UI) or "/redoc" (Redoc) paths. If you change the path of a document page or use a custom document page, you need to update the URL in this function accordingly. 

**Output example**: Since the purpose of this function is to do page redirects, it does not directly produce a visual output. However, in the browser, when the root path ("/") is accessed, the browser's address bar will be displayed as "/docs" and the corresponding API documentation page will be displayed. 
## FunctionDef create_app(run_mode)
Doc is waiting to be generated...
## FunctionDef mount_app_routes(app, run_mode)
**mount_app_routes**: This function is used to mount application routes in a FastAPI application. 

**Parameters**:
- `app`: An instance of the FastAPI application that is used to register routes.
- `run_mode`: A runtime mode that distinguishes between the environment in which an app runs, such as a development environment or a production environment.

**Code Description**:
`mount_app_routes`Functions are used to register various API routes in the FastAPI application instance. These routes include interfaces for dialogue, search engine dialogue, chat log feedback, knowledge base management, LLM model management, server status query, and other functions. Through calls`app.get` and `app.post`methods, a specific URL path is bound to a handler to implement the routing function of the API. In addition, the function calls`mount_knowledge_routes` `mount_filename_summary_routes`and two functions, which are used to mount routes related to the knowledge base and file name digests, respectively. In the process of registering routes, each API interface is provided with tags, summary, and other information to facilitate classification and description in the API documentation. 

**Note**:
- Before using `mount_app_routes`functions, you need to make sure that you have created a FastAPI application instance and that all handlers have been correctly defined. 
- This function is the entry point for API route registration, through which various functional interfaces of the application can be integrated into the FastAPI application.
- During actual deployment and use, pay attention to the security of API interfaces to avoid unauthorized access and operation.
- `run_mode`Parameters can be used to adjust the behavior of the API for different runtime environments, such as enabling debug mode in the development environment and optimizing performance in the production environment.

**Example output**:
Since `mount_app_routes`the function does what it does to register a route without returning data directly, it doesn't have a direct output example. After the function is executed, the FastAPI application can respond to the HTTP request of the corresponding route and call the corresponding handler based on the URL path of the request. For example, when a user requests access a path through an HTTP POST`/chat/chat`, the FastAPI application calls `chat`a function to process the request and returns the processing result. 
### FunctionDef get_server_prompt_template(type, name)
**get_server_prompt_template**: This function is used to dynamically load and return the corresponding template content based on the provided type and name parameters. 

**Parameters**:
- type: Literal type, which can be llm_chat, knowledge_base_chat, search_engine_chat, or agent_chat, and is used to specify the type of the template. The default value is llm_chat.
- name: A string type that specifies the name of the template. The default value is "default".

**Code Description**:
`get_server_prompt_template`A function is the entry point at the API level to handle template loading requests. The function takes two parameters:`type` and `name`, which represent the type and name of the template, respectively. The function is called internally`get_prompt_template`, passing in the same`type` sum arguments `name`to get the specified template contents. 

`get_prompt_template`The function is located in a `server/utils.py`file and is responsible for loading the template content of the specified type and name from the configuration. It first`configs` imports `prompt_config`the configuration from the module and then reloads it with`importlib.reload` a method `prompt_config`to ensure that it gets the most up-to-date configuration information. You can`type` use parameters `prompt_config.PROMPT_TEMPLATES`to index the template dictionary of the corresponding type, and then use the parameters to`name` obtain the specific template content from the dictionary. If the specified`name` does not exist in the dictionary, it is returned`None`. 

In the project structure,`get_server_prompt_template` functions are located `server/api.py/mount_app_routes`under the path as part of the API interface, allowing the front-end or other services to dynamically fetch template content of different types and names via HTTP requests, thus supporting flexible chat modes or feature requirements. 

**Note**:
- When calling `get_server_prompt_template`a function, you need to make sure that`type` `name`the values of the sum parameters are correct and that the requested template has been`prompt_config` defined in . 
- Because `get_prompt_template`the function relies on an external configuration file`prompt_config`, you may need to restart the service or dynamically reload the configuration after modifying the configuration file to ensure that the changes take effect. 

**Example output**:
The following template configuration is assumed to exist:
```python
PROMPT_TEMPLATES = {
    "llm_chat": {
        "default": "你好，请问有什么可以帮助你的？"
    }
}
```
When called`get_server_prompt_template(type="llm_chat", name="default")`, a string is returned`"你好，请问有什么可以帮助你的？"`. 
***
## FunctionDef mount_knowledge_routes(app)
**mount_knowledge_routes**: The function of this function is to mount the knowledge base related routes in the FastAPI application. 

**Argument**: The function accepts a parameter:
- `app`: An instance of the FastAPI application that is used to register routes.

**Code Description**: The `mount_knowledge_routes` function is mainly responsible for registering the API interfaces related to knowledge base management and operation into the FastAPI application. The routing function of the API is implemented by importing different handlers, such as`knowledge_base_chat` ,`upload_temp_docs` ,`file_chat` `agent_chat`etc., and using`app.post` or `app.get`methods to bind these handlers to a specific URL path. In addition, the function also sets tags, summary, and other information for each API interface to facilitate classification and description in the API documentation. 

This function covers multiple functions such as creating, deleting, uploading, deleting, searching, updating, downloading, and rebuilding vector libraries. Each feature is accessed through a specific URL path, for example, through which`/knowledge_base/create_knowledge_base` the interface for creating a knowledge base can be accessed. 

**Note**:
- Before using `mount_knowledge_routes`functions, you need to make sure that you have created a FastAPI application instance and that all handlers have been correctly defined. 
- This function is the entry point of the knowledge base management function in the FastAPI framework, through which knowledge base-related operations can be integrated into the FastAPI application.
- During actual deployment and use, pay attention to the security of API interfaces to avoid unauthorized access and operation.
## FunctionDef mount_filename_summary_routes(app)
**mount_filename_summary_routes**: The function of this function is to mount a route that handles filename digests in a FastAPI application. 

**Parameters**:
- `app`: An instance of the FastAPI application that is used to register routes.

**Code Description**:
`mount_filename_summary_routes`The function is primarily responsible for registering three POST routes related to the filename digest in the FastAPI application. These routes are used to handle requests for a single knowledge base to digest against file names, digest against doc_ids, and reconstruct individual knowledge base file digests, respectively. 

1. `/knowledge_base/kb_summary_api/summary_file_to_vector_store`Routing is used to process summarizing a single knowledge base based on the file name and storing the summary results in a vector store. This route uses`summary_file_to_vector_store` a function to handle the request. 

2. `/knowledge_base/kb_summary_api/summary_doc_ids_to_vector_store`Routing is used to process the generation of a document summary of a single knowledge base based on a list of document IDs, and to store the summary information in a vector store. This route uses`summary_doc_ids_to_vector_store` a function to process the request and specifies`response_model` it as `BaseResponse`to normalize the response format. 

3. `/knowledge_base/kb_summary_api/recreate_summary_vector_store`Routes are used to handle requests to reconstruct a summary of a single knowledge base file. This route uses`recreate_summary_vector_store` a function to handle the request. 

Each route is registered with a `app.post`method and specifies the route's path, handler, tags, and summary. This information helps generate automated API documentation that improves the discoverability and comprehensibility of the API. 

**Note**:
- Before using these APIs, make sure that the relevant handlers have been implemented correctly and that the knowledge base service has been configured.
- By specifying`response_model` as, `BaseResponse`you can unify the response format of the API, making the response data more standardized and convenient for the client to process. 
- These routes are mainly used to handle the generation and management of knowledge base file summaries, so when calling these APIs, you need to provide information such as the correct knowledge base name, file name, or document ID list.
- In a project, `mount_filename_summary_routes`functions are called by `mount_app_routes`functions, which means that these filename digest-related routes are automatically mounted and registered as part of the application. This helps to keep the centralized management of routing registrations and the application structure clear. 
## FunctionDef run_api(host, port)
**run_api**: The function of this function is to start an API service. 

**Parameters**:
- **host**: The hostname or IP address of the server. 
- **port**: The port number of the server listening. 
- **kwargs**: keyword parameter, optional, used to provide the SSL certificate file path. 

**Code Description**:
`run_api`Functions are responsible for starting API services. It accepts three parameters:`host` , and `port`optionally a keyword parameter`kwargs`. These parameters are used to specify the listening address and port of the server, as well as the path of the certificate file required to configure the SSL-encrypted connection. 

The function first checks to `kwargs`see if both keyword arguments are provided and`ssl_keyfile` `ssl_certfile`these two keywords. If both of these parameters are provided, the function will use these certificate files to start an API service that supports SSL encryption. This is achieved by calling`uvicorn.run` a function and passing in the corresponding parameters, including the application instance`app`, hostname`host`, port number`port`, SSL key file path, `ssl_keyfile`and SSL certificate file path`ssl_certfile`. 

If `kwargs`no SSL-related parameters are provided, the `run_api`function will start an API service that does not use SSL encryption. Again, this is done by calling`uvicorn.run` a function, but in this case only the application instance`app`, hostname, `host`and port number `port`are passed in as parameters. 

**Note**:
- Ensure that the path to the SSL certificate file and key file has been correctly generated and specified before starting the SSL-enabled API service.
- In the absence of an SSL certificate file path, the API service will run in non-encrypted mode, which may not be suitable for handling sensitive information in a production environment.
- `uvicorn.run`Part of the Uvicorn library, a lightweight, ultra-fast ASGI server for Python asynchronous web applications. Make sure you`run_api` have the Uvicorn library installed before using the function. 
